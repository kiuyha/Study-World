{% extends "admin/template_admin.html" %}
{% block title %}Page Management{% endblock %}

{% block extra_style %}
<style>
        main{
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        header {
            width: 100%;
            height: 60px;
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            padding: 10px;
            border-bottom: #8a8a8a solid 1px;
            gap: 10px;
            position: sticky;
            top: 0;
            background-color: #11121a;
            z-index: 3;
        }

        header input[type="text"] {
            flex: 1;
            margin-left: 5px;
            padding: 10px;
            border-radius: 20px;
            border: 1px solid #ffffff;
            width: 70%;
            height: auto;
            color: #ffffff;
            background-color: transparent;
            background-image: url("/static/img/dash/search-icon.svg");
            background-repeat: no-repeat;
            background-position: 10px center;
            background-size: 20px 20px;
            padding-left: 40px;
            margin-right: 15px;
        }
        
        header input[type="text"]::placeholder {
            color: #ffffff;
        }

        header .icons {
            width: auto;
            height: 100%;
            display: flex;
            align-items: center;
            margin-right: 5px;
            margin-left: 20px;
            justify-content: flex-end;
            gap: 20px;
        }

        header .icons button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            width: auto;
            height: 100%;
        }
        
        header .icons button img{
            width: 40px;
            height: 40px;
        }
        @media (min-width: 768px) {
            .hamburger{
                display: none;
            }
        }
    .buttons{
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 15px;
    }
    .buttons button{
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        border: none;
        gap: 8px;
    }
    #filter-btn {
        background-color: #333333;
    }

    #filter-btn:hover {
        background-color: #555555;
    }
    .click{
        background-color: #555555 !important;
        svg{
           transform: rotate(180deg) !important; 
        }
    }
    #create-btn{
        background-color: #ff1616;
    }
    #create-btn:hover {
        background-color: #ff3333;
    }
    #filter-box ul {
        list-style: none;
        padding: 0;
    }

    #filter-box li {
        display: flex;
        align-items: center;
        margin: 5px 0;
    }

    #filter-box input[type="checkbox"] {
        margin-right: 10px;
    }

    #filter-box {
        display: flex;
        gap: 10%;
        margin: 10px;
        position: relative;
        background: #333333;
        padding: 20px 20px;
        border-radius: 5px;
        width: 100%;
        z-index: 1;
    }
    .hidden{
        display: none !important;
    }

    #content-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: 100%;
    padding: 20px;
    }

    .content-box {
    display: flex;
    justify-content: space-between;
    background-color: #333333;
    border: 1px solid #8a8a8a;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(160, 158, 158, 0.1);
    padding: 15px;
    flex-grow: 1;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .content-box h2 {
    margin-top: 0;
    color: #ffffff;
    margin-bottom: 10px;
    }

    .content-box p {
    color: #d4d4d4;
    font-weight: 400;
    font-size: 12px;
    }

    .content-box:hover {
    transform: scale(1.03);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .flex-left{
        display: flex;
        flex-direction: column;
    }
    .flex-right{
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }
    .flex-text{
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        gap: 10px;
    }
    .flex-button{
        margin-bottom: 3px;
        a{
            display: inline-block;
            height: 100%;
            width: auto;
            padding: 3px;
            border-radius: 50%;
        }
        button{
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 3px;
            margin: 0;
            width: auto;
            height: 100%;
            border-radius: 50%;
        }
        svg{
            width: 30px;
            height: 30px;
        }
        button:hover,
        a:hover{
            background-color: #555555;
        }
    }
    a{
        text-decoration: none;
    }
</style>
{% endblock %}

{% block main_content %}
<main>
    <header>
        <button onclick="toggleSidebar()" class="hamburger toggle-btn">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ffffff"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
        </button>
        <input type="text" placeholder="Search...">
        <div class="icons">
            <button><img src="{{ url_for('static', filename='img/dash/notif-icon.svg') }}"></button>
            <button><img src="{{ url_for('static', filename='img/dash/pp-icon.svg') }}"></button>
        </div>
    </header>
    <div class="buttons">
        <button id="filter-btn">
            <p>Filter</p>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-344 240-584l56-56 184 184 184-184 56 56-240 240Z"/></svg>
        </button>
        <button id="create-btn">
            <p>Create</p>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/></svg>
        </button>
    </div>
        <div id="filter-box" class="hidden">
            <ul id="classes">
                <p>Classes :</p>
                {% for class in classes %}
                <li>
                    <input type="checkbox" id="class_{{ loop.index }}" />
                    <label for="class_{{ loop.index }}">{{ class }}</label>
                </li>
                {% endfor %}
            </ul>
            <ul id="courses">
                <p>Courses :</p>
                {% for course in courses %}
                <li>
                    <input type="checkbox" id="course_{{ loop.index }}" />
                    <label for="course_{{ loop.index }}">{{ course }}</label>
                </li>
                {% endfor %}
            </ul>
        </div>
    <div id="content-container">
        {% if content_data %}
            {% for content in content_data %}
            <div class="content-box">
                <a href="{{ url_for('admin.edit_module', class_name=content.class, course=content.course, course_file=content.module) }}">
                    <div class="flex-left">
                        <h2>{{ content.module }}</h2>
                        <div class="flex-text">
                            <p>{{ content.class }}</p>
                            <p>|</p>
                            <p>{{ content.course }}</p>
                        </div>
                        <p>{{ content.created_at }}</p>
                    </div>
                </a>
                <div class="flex-right">
                    <div class="flex-button">
                        <a href="{{ url_for('views.course_file_route', class_name=content.class, course=content.course, course_file=content.module) }}">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-480H200v480Zm280-80q-82 0-146.5-44.5T240-440q29-71 93.5-115.5T480-600q82 0 146.5 44.5T720-440q-29 71-93.5 115.5T480-280Zm0-60q56 0 102-26.5t72-73.5q-26-47-72-73.5T480-540q-56 0-102 26.5T306-440q26 47 72 73.5T480-340Zm0-100Zm0 60q25 0 42.5-17.5T540-440q0-25-17.5-42.5T480-500q-25 0-42.5 17.5T420-440q0 25 17.5 42.5T480-380Z"/></svg>
                        </a>
                        <button onclick="remove_content(this)"
                                data-class="{{ content.class }}"
                                data-course="{{ content.course }}"
                                data-module="{{ content.module }}">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
                        </button>
                    </div>
                    <p>Views: {{ content.views }}</p>
                    <p>Creator: {{ content.creator }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No content found.</p>
        {% endif %}
    
</main>
{% endblock %}
{% block extra_script %}
<script>
    let delete_content = null;

    const checkboxes = document.querySelectorAll("input[type='checkbox']");
    
    checkboxes.forEach((checkbox) =>{
            checkbox.checked = true;
    });
    function remove_content(button){
        let classe = button.getAttribute('data-class');
        let course = button.getAttribute('data-course');
        let modul = button.getAttribute('data-module');
        if(confirm(`Are you sure you want to remove the content for module ${modul}, class ${classe}, course ${course}?`)){
            delete_content = {
                'class': classe,
                'course': course,
                'module': modul,
            }
            send_data()
        }
    }
    const button = document.getElementById('filter-btn')
    button.addEventListener("click", () =>{
        button.classList.toggle('click');
        const filter_check = document.getElementById('filter-box')
        if(filter_check.classList.contains('hidden')){
            filter_check.classList.remove('hidden');
        }else{
            filter_check.classList.add('hidden');
            send_data()
        }
    });
    
    function send_data(){
        let data = {};
        if (delete_content){
            data['delete'] = delete_content
        }
        const filter_check = document.getElementById('filter-box')
        filter_check.querySelectorAll("ul").forEach(ul => {
            ul.querySelectorAll('li').forEach(li => {
                const label = li.querySelector('label');
                if (label) {
                    const category = label.textContent.trim();
                    const checkbox = li.querySelector('input[type="checkbox"]');
                    if (checkbox && checkbox.checked) {
                        if (!data[ul.id]) {
                            data[ul.id] = [];
                        }
                        data[ul.id].push(category);
                    };
                };
            });
        });
        fetch("{{ url_for('admin.pages') }}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data),
        }).then(Response => Response.text())
        .then(html => {
            document.getElementById('content-container').outerHTML = html;
        })
    }
</script>
{% endblock %}
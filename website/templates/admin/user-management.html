{% extends "admin/template_admin.html" %}
{% block title %}User Management{% endblock %}

{% block extra_style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/user-management.css') }}">
{% endblock %}
{% block popup %}
<div id="popup-container" class="hidden"> 
    <div class="popup">
        <div id="back-box">
            <button class="back" onclick="togglePopup()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#e8eaed"><path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"/></svg>
                <span>Kembali</span>
            </button>
        </div>
        <h2>Anoncement</h2>
        <form>
            <div>
                <p>Headline</p>
                <input type="text" name="headline">
            </div>
            <div>
                <p>Message</p>
                <textarea name="message" id="message" cols="80" rows="10"></textarea>
            </div>
            <button type="submit" class="submit">Send</button>
        </form>
    </div>
</div>
<div id="messages"></div>
{% endblock %}
{% block main_content %}
    <header>
        <button onclick="toggleSidebar()" class="hamburger toggle-btn">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ffffff"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
        </button>
        <input type="text" id="search-bar" placeholder="Search...">
        <div class="icons">
            <button id="notif-btn" onclick="toggleDropdown('dropdown-notif')"><img src="{{ url_for('static', filename='img/dash/notif-icon.svg') }}"></button>
            <button id="pp-btn" onclick="location.href=`{{ url_for('views.profile') }}`"><img src="{{ url_for('static', filename=user.photo) }}"></button>
        </div>
    </header>
    <div id="dropdown-notif" class="hidden">
        <div id="notif-container">
            <h2>Notifikasi</h2>
            <div id="notif-filter">
                <button class="active" onclick="change_notif(this)">Aktivitas</button>
                <button onclick="change_notif(this)">Pengumuman</button>
            </div>
            <ul class="notif-list hidden" id="Aktivitas">
            {% for notif in notifications %}
            {% if not notif[2] %}
            <li>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#EAC452"><path d="m354-287 126-76 126 77-33-144 111-96-146-13-58-136-58 135-146 13 111 97-33 143ZM233-120l65-281L80-590l288-25 112-265 112 265 288 25-218 189 65 281-247-149-247 149Zm247-350Z"/></svg>
                <span>
                    <p>{{ notif[0] }}</p>
                    <h6>{{ notif[1] }}</h6>
                </span>
            </li>
            {% endif %}
            {% endfor %}
            </ul>
            <ul class="notif-list hidden" id="Pengumuman">
                {% for notif in notifications %}
                {% if notif[2] %}
                <li {% if notif[1] | length > 70 %} onclick="toggleFullContent('full-content-notif{{ loop.index }}')" style="cursor: pointer;" {% endif %}>
                    <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 -960 960 960" fill="#FFFFFF"><path d="M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                    <span>
                        <p>{{ notif[0] }}</p>
                        <h6>{% if notif[1] | length > 70 %}{{ notif[1][:70] + "..." }} {% else %} {{ notif[1] }} {% endif %}</h6>
                    </span>
                </li>
                {% endif %}
                {% endfor %}
            </ul>
        </div>
        <div id="full-content">
            {% for notif in notifications %}
            {% if notif[2] %}
            {% if notif[1] | length > 70 %}
            <div id="full-content-notif{{ loop.index }}" class="full-content-notif hidden">
                <div id="back-box">
                    <button class="back" onclick="toggleFullContent('full-content-notif{{ loop.index }}')">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#e8eaed"><path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"/></svg>
                        <span>Kembali</span>
                    </button>    
                </div>
                <p>{{ notif[0] }}</p>
                <h6>{{ notif[1] }}</h6>
            </div>
            {% endif %}
            {% endif %}
            {% endfor %}
        </div>
    </div>
    <div class="buttons">
        <button onclick="togglePopup()">
            <p>Anoncement</p>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M720-440v-80h160v80H720Zm48 280-128-96 48-64 128 96-48 64Zm-80-480-48-64 128-96 48 64-128 96ZM200-200v-160h-40q-33 0-56.5-23.5T80-440v-80q0-33 23.5-56.5T160-600h160l200-120v480L320-360h-40v160h-80Zm240-182v-196l-98 58H160v80h182l98 58Zm120 36v-268q27 24 43.5 58.5T620-480q0 41-16.5 75.5T560-346ZM300-480Z"/></svg>
        </button>
    </div>
    <div>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Points</th>
                    <th>Role</th>
                </tr>
            </thead>
            <tbody id="users-data">
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.points }}</td>
                    <td>
                        <select class="role" {% if user.id == 1 %} disabled {% endif %}>
                            <option value="admin" {% if user.admin %}selected{% endif %}>Admin</option>                        
                            <option value="user" {% if not user.admin %}selected{% endif %}>User</option>
                        </select>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="pagination">
    </div>
    <input type="hidden" id="total-pages" value="{{total_pages}}">
{% endblock %}

{% block extra_script %}
<script src="{{ url_for('static', filename='js/admin/user-management.js') }}"></script>
{% endblock %}